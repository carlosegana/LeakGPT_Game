<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeakGPT CTF Arena - Final Score</title>
    <style>
        body { 
            background: url('/static/2LNj.gif') no-repeat center center fixed; 
            background-size: cover; 
            color: #fff; 
            font-family: 'Fira Mono', 'Consolas', monospace; 
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 40px auto; 
            background: rgba(24, 26, 32, 0.99); 
            padding: 40px; 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.95); 
            border: 1px solid #2c313c; 
            backdrop-filter: blur(20px);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .title {
            color: #61dafb;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #61dafb;
        }
        .subtitle {
            color: #aaa;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .score-display {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3);
        }
        .total-score {
            font-size: 4em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
        }
        .score-label {
            font-size: 1.3em;
            color: #fff;
            opacity: 0.9;
        }
        .rank-section {
            text-align: center;
            margin-bottom: 30px;
        }
        .rank-title {
            font-size: 2em;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 15px #ffd700;
        }
        .rank-description {
            color: #aaa;
            font-size: 1.1em;
            line-height: 1.5;
        }
        .progress-section {
            background: rgba(35, 39, 46, 0.8);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .progress-title {
            color: #61dafb;
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
        }
        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .progress-fill {
            background: linear-gradient(90deg, #22c55e, #16a34a);
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 10px;
        }
        .progress-text {
            text-align: center;
            color: #aaa;
            font-size: 1.1em;
        }
        .completed-levels {
            background: rgba(35, 39, 46, 0.8);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .completed-title {
            color: #61dafb;
            font-size: 1.4em;
            margin-bottom: 20px;
            text-align: center;
        }
        .level-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(24, 26, 32, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #22c55e;
        }
        .level-info {
            flex: 1;
        }
        .level-name {
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .level-description {
            color: #aaa;
            font-size: 0.9em;
        }
        .level-score {
            background: #ffd700;
            color: #23272e;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background: #61dafb;
            color: #23272e;
        }
        .btn-primary:hover {
            background: #21a1c4;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #ff5555;
            color: #fff;
        }
        .btn-secondary:hover {
            background: #ff3333;
            transform: translateY(-2px);
        }
        .trophy-icon {
            font-size: 1.5em;
            margin-right: 10px;
            animation: trophy-glow 2s ease-in-out infinite alternate;
        }
        @keyframes trophy-glow {
            0% { text-shadow: 0 0 5px #ffd700; }
            100% { text-shadow: 0 0 15px #ffd700, 0 0 25px #ffd700; }
        }
        .mute-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(35, 39, 46, 0.9);
            color: #61dafb;
            border: 2px solid #61dafb;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .mute-button:hover {
            background: #61dafb;
            color: #23272e;
            transform: scale(1.1);
        }
        .mute-button.muted {
            background: #ff5555;
            border-color: #ff5555;
            color: #fff;
        }
        .mute-button.muted:hover {
            background: #ff3333;
            border-color: #ff3333;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                margin: 20px auto;
                padding: 30px 20px;
            }
            .title {
                font-size: 2em;
            }
            .subtitle {
                font-size: 1.1em;
            }
            .total-score {
                font-size: 3em;
            }
            .rank-title {
                font-size: 1.6em;
            }
            .level-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .level-score {
                align-self: flex-end;
            }
            .actions {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 10px auto;
                padding: 20px 15px;
            }
            .title {
                font-size: 1.6em;
            }
            .total-score {
                font-size: 2.5em;
            }
            .rank-title {
                font-size: 1.4em;
            }
            .progress-section,
            .completed-levels {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Hidden Audio Element -->
    <audio id="bg-music" src="/static/jungle-waves-drumampbass-electronic-inspiring-promo-345013.mp3" loop preload="auto"></audio>
    
    <!-- Mute Button -->
    <button id="mute-button" class="mute-button" title="Toggle Music">
        üîä
    </button>
    
    <div class="container">
        <div class="header">
            <h1 class="title">üèÜ Challenge Results</h1>
            <div class="subtitle">Your LeakGPT CTF Arena Performance</div>
        </div>
        
        <div class="score-display">
            <div class="total-score">{{ total_score }}</div>
            <div class="score-label">Total Points Earned</div>
        </div>
        
        <div class="rank-section">
            <div class="rank-title">{{ rank }}</div>
            <div class="rank-description">{{ rank_description }}</div>
        </div>
        
        <div class="progress-section">
            <div class="progress-title">üìä Completion Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ completion_percentage }}%"></div>
            </div>
            <div class="progress-text">{{ completed_count }} of {{ total_levels }} levels completed ({{ "%.1f"|format(completion_percentage) }}%)</div>
        </div>
        
        {% if completed_details %}
        <div class="completed-levels">
            <div class="completed-title">‚úÖ Completed Challenges</div>
            {% for level in completed_details %}
            <div class="level-item">
                <div class="level-info">
                    <div class="level-name">
                        <span class="trophy-icon">üèÜ</span>
                        {{ level.level|capitalize }}
                    </div>
                    <div class="level-description">{{ level.description }}</div>
                </div>
                <div class="level-score">+{{ level.score }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="actions">
            <a href="/" class="btn btn-primary">üè† Back to Menu</a>
            <a href="/reset" class="btn btn-secondary">üîÑ Reset All Progress</a>
        </div>
    </div>
    
    <script>
        // Music starts on first user interaction
        document.addEventListener('click', function() {
            const music = document.getElementById('bg-music');
            if (music && music.paused) {
                music.play().then(() => {
                    console.log('Music started on first interaction');
                }).catch(error => {
                    console.log('Failed to start music:', error);
                });
            }
        }, { once: true });
        
        // Direct audio control
        const music = document.getElementById('bg-music');
        const muteButton = document.getElementById('mute-button');
        let isMuted = false;
        
        // Set volume
        music.volume = 0.7;
        
        // Restore music position from localStorage
        const savedTime = localStorage.getItem('musicTime');
        const savedMuted = localStorage.getItem('musicMuted');
        
        if (savedTime) {
            music.currentTime = parseFloat(savedTime);
        }
        
        if (savedMuted === 'true') {
            isMuted = true;
            music.muted = true;
            muteButton.textContent = 'üîá';
            muteButton.classList.add('muted');
        }
        
        // Start music on first user interaction
        function startMusic() {
            music.play().then(() => {
                console.log('Music started successfully');
            }).catch(error => {
                console.log('Failed to start music:', error);
            });
        }
        
        // Mute button functionality
        muteButton.addEventListener('click', function() {
            console.log('Mute button clicked');
            isMuted = !isMuted;
            
            if (isMuted) {
                music.muted = true;
                muteButton.textContent = 'üîá';
                muteButton.classList.add('muted');
                console.log('Music muted');
            } else {
                music.muted = false;
                muteButton.textContent = 'üîä';
                muteButton.classList.remove('muted');
                console.log('Music unmuted');
            }
            
            // Save mute state
            localStorage.setItem('musicMuted', isMuted);
        });
        
        // Save music position periodically
        setInterval(() => {
            if (!music.paused) {
                localStorage.setItem('musicTime', music.currentTime);
            }
        }, 1000);
        
        // Save music position before page unload
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('musicTime', music.currentTime);
            localStorage.setItem('musicMuted', isMuted);
        });
        
        // Start music on first click anywhere and ensure it never stops
        document.addEventListener('click', function() {
            if (music.paused) {
                startMusic();
            }
        });
        
        // Auto-restart music if paused (but not muted)
        setInterval(() => {
            if (music.paused && !isMuted) {
                startMusic();
            }
        }, 2000);
        
        // Listen for pause events and restart if not muted
        music.addEventListener('pause', function() {
            if (!isMuted) {
                setTimeout(() => {
                    if (music.paused) {
                        startMusic();
                    }
                }, 100);
            }
        });
        
        // Animate progress bar on load
        window.addEventListener('load', function() {
            const progressFill = document.querySelector('.progress-fill');
            progressFill.style.width = '0%';
            setTimeout(() => {
                progressFill.style.width = '{{ completion_percentage }}%';
            }, 500);
        });
    </script>
</body>
</html> 